<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Context - FreeWorld OS Documentation</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Navigation</h2>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li class="nav-section">Boot Components</li>
                <li><a href="bootmgr.html">BOOTMGR</a></li>
                <li><a href="bcd.html">BCD</a></li>
                <li><a href="freeload.html">freeload.exe</a></li>
                <li class="nav-section">Core System</li>
                <li><a href="kernel.html">fwoskrnl.exe</a></li>
                <li><a href="hal.html">hal.dll</a></li>
                <li class="nav-section">Services</li>
                <li><a href="smss.html">smss.exe</a></li>
                <li><a href="csrss.html">csrss.exe</a></li>
                <li><a href="freeworldlogon.html">freeworldlogon.exe</a></li>
                <li class="nav-section">User Interface</li>
                <li><a href="shell.html">Shell</a></li>
                <li><a href="wanderer.html">Wanderer</a></li>
                <li class="nav-section">GUI Subsystems</li>
                <li><a href="dc.html">Device Context</a></li>
                <li><a href="compositor.html">Compositor</a></li>
                <li><a href="resources.html">Resource Manager</a></li>
                <li><a href="input.html">Input Manager</a></li>
                <li><a href="clipboard.html">Clipboard & Drag & Drop</a></li>
                <li><a href="window-relationships.html">Window Relationships</a></li>
                <li><a href="menu.html">Menu System</a></li>
                <li><a href="nonclient.html">Non-Client Area</a></li>
                <li><a href="controls.html">Standard Controls</a></li>
                <li><a href="timer.html">Timer Manager</a></li>
                <li><a href="property.html">Property Manager</a></li>
                <li><a href="hooks.html">Hook Manager</a></li>
                <li><a href="focus.html">Focus Manager</a></li>
                <li class="nav-section">System Services</li>
                <li><a href="object-manager.html">Object Manager</a></li>
                <li><a href="path.html">Path Parser</a></li>
                <li><a href="registry.html">Registry</a></li>
                <li><a href="filesystem-watcher.html">File System Watcher</a></li>
                <li><a href="security.html">Security Manager</a></li>
                <li><a href="error.html">Error Manager</a></li>
                <li><a href="shell-ecosystem.html">Shell Ecosystem</a></li>
                <li class="nav-section">Node.js System</li>
                <li><a href="window.html">Window API</a></li>
                <li><a href="desktop.html">Desktop</a></li>
                <li><a href="api.html">System API</a></li>
                <li><a href="filesystem.html">Filesystem API</a></li>
                <li><a href="integration.html">System Integration</a></li>
                <li class="nav-section">Reference</li>
                <li><a href="naming-conventions.html">Naming Conventions</a></li>
                <li><a href="boot-process.html">Boot Process</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="syscalls.html">System Calls</a></li>
                <li><a href="variables.html">Variables & Constants</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="page-header">
                <h1>Device Context (DC)</h1>
                <div class="meta">
                    <strong>Location:</strong> system/dc.js<br>
                    <strong>Type:</strong> Node.js Module<br>
                    <strong>Purpose:</strong> Virtual canvas for drawing operations
                </div>
            </div>

            <section class="section">
                <h2>Overview</h2>
                <p>Device Context (DC) is a virtual canvas class that provides drawing operations. In FreeWorld, applications don't draw directly to the screen; they draw to a Device Context, which is then composited by the Compositor.</p>
                <div class="alert alert-info">
                    <strong>Note:</strong> This is a structural implementation. Actual pixel rendering requires hardware access and is not yet implemented.
                </div>
            </section>

            <section class="section">
                <h2>Constructor</h2>
                <div class="code-block">
                    <pre>constructor(width, height)</pre>
                </div>
                <p><strong>Parameters:</strong></p>
                <ul>
                    <li><code>width</code>: Canvas width in pixels</li>
                    <li><code>height</code>: Canvas height in pixels</li>
                </ul>
            </section>

            <section class="section">
                <h2>Properties</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>width</code></td>
                            <td>number</td>
                            <td>Canvas width</td>
                        </tr>
                        <tr>
                            <td><code>height</code></td>
                            <td>number</td>
                            <td>Canvas height</td>
                        </tr>
                        <tr>
                            <td><code>canvas</code></td>
                            <td>object</td>
                            <td>Canvas data structure (RGBA array)</td>
                        </tr>
                        <tr>
                            <td><code>ctx</code></td>
                            <td>object</td>
                            <td>Drawing context (placeholder)</td>
                        </tr>
                        <tr>
                            <td><code>pen</code></td>
                            <td>object|null</td>
                            <td>Current pen (for lines/borders)</td>
                        </tr>
                        <tr>
                            <td><code>brush</code></td>
                            <td>object|null</td>
                            <td>Current brush (for fills)</td>
                        </tr>
                        <tr>
                            <td><code>font</code></td>
                            <td>object|null</td>
                            <td>Current font</td>
                        </tr>
                        <tr>
                            <td><code>clipRegion</code></td>
                            <td>object|null</td>
                            <td>Clipping region rectangle</td>
                        </tr>
                        <tr>
                            <td><code>dirtyRegions</code></td>
                            <td>Array</td>
                            <td>Array of dirty regions for invalidation</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="section">
                <h2>Drawing Methods</h2>
                
                <h3>drawPixel(x, y, color)</h3>
                <p>Draws a single pixel at the specified coordinates.</p>
                <p><strong>Parameters:</strong></p>
                <ul>
                    <li><code>x</code>: X coordinate</li>
                    <li><code>y</code>: Y coordinate</li>
                    <li><code>color</code>: Color object {r, g, b, a}</li>
                </ul>

                <h3>drawLine(x1, y1, x2, y2)</h3>
                <p>Draws a line using Bresenham's algorithm.</p>
                <p><strong>Note:</strong> Requires a pen to be selected.</p>

                <h3>drawRectangle(x, y, width, height, filled)</h3>
                <p>Draws a rectangle. If filled is true, uses brush; otherwise uses pen.</p>

                <h3>drawText(x, y, text)</h3>
                <p>Draws text at the specified position.</p>
                <p><strong>Note:</strong> Requires a font to be selected.</p>

                <h3>bitBlt(destX, destY, sourceDC, sourceX, sourceY, width, height)</h3>
                <p>Copies pixels from source DC to this DC (Bit Block Transfer).</p>
            </section>

            <section class="section">
                <h2>Clipping</h2>
                
                <h3>setClipRegion(x, y, width, height)</h3>
                <p>Sets the clipping region. Drawing operations outside this region are ignored.</p>

                <h3>isClipped(x, y)</h3>
                <p>Checks if a point is outside the clipping region.</p>
            </section>

            <section class="section">
                <h2>Dirty Region Tracking</h2>
                
                <h3>markDirty(x, y, width, height)</h3>
                <p>Marks a region as dirty (needs repainting).</p>

                <h3>getDirtyRegions()</h3>
                <p>Returns array of dirty regions.</p>

                <h3>clearDirtyRegions()</h3>
                <p>Clears the dirty region list.</p>
            </section>

            <section class="section">
                <h2>GDI Object Selection</h2>
                
                <h3>selectObject(obj)</h3>
                <p>Selects a GDI object (Pen, Brush, or Font) for drawing operations.</p>
                <p><strong>Object Types:</strong></p>
                <ul>
                    <li><code>PEN</code> - For lines and borders</li>
                    <li><code>BRUSH</code> - For filled shapes</li>
                    <li><code>FONT</code> - For text rendering</li>
                </ul>
            </section>

            <section class="section">
                <h2>Usage Example</h2>
                <div class="code-block">
                    <pre>const DeviceContext = require('./system/dc');
const ResourceManager = require('./system/resources');

const dc = new DeviceContext(800, 600);
const rm = new ResourceManager();

// Select pen and brush
const pen = rm.createPen({r: 0, g: 0, b: 0}, 1);
const brush = rm.createBrush({r: 255, g: 255, b: 255});
dc.selectObject(pen);
dc.selectObject(brush);

// Draw rectangle
dc.drawRectangle(10, 10, 100, 50, true);

// Draw line
dc.drawLine(10, 10, 110, 60);

// Mark region as dirty
dc.markDirty(10, 10, 100, 50);</pre>
                </div>
            </section>

            <section class="section">
                <h2>Implementation Status</h2>
                <div class="alert alert-warning">
                    <strong>Current Status:</strong> Structural implementation only. Actual pixel rendering requires:
                    <ul>
                        <li>Hardware graphics driver</li>
                        <li>Frame buffer access</li>
                        <li>VGA/VESA or modern graphics API</li>
                    </ul>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <p>FreeWorld OS Documentation v0.1.0</p>
    </footer>

    <script src="../navigation.js"></script>
</body>
</html>

