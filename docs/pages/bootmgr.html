<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOTMGR - FreeWorld OS Documentation</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Navigation</h2>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li class="nav-section">Boot Components</li>
                <li><a href="bootmgr.html">BOOTMGR</a></li>
                <li><a href="bcd.html">BCD</a></li>
                <li><a href="freeload.html">freeload.exe</a></li>
                <li class="nav-section">Core System</li>
                <li><a href="kernel.html">fwoskrnl.exe</a></li>
                <li><a href="hal.html">hal.dll</a></li>
                <li class="nav-section">Services</li>
                <li><a href="smss.html">smss.exe</a></li>
                <li><a href="csrss.html">csrss.exe</a></li>
                <li><a href="freeworldlogon.html">freeworldlogon.exe</a></li>
                <li class="nav-section">User Interface</li>
                <li><a href="shell.html">Shell</a></li>
                <li><a href="wanderer.html">Wanderer</a></li>
                <li class="nav-section">Node.js System</li>
                <li><a href="window.html">Window API</a></li>
                <li><a href="desktop.html">Desktop</a></li>
                <li><a href="api.html">System API</a></li>
                <li><a href="filesystem.html">Filesystem API</a></li>
                <li class="nav-section">Reference</li>
                <li><a href="naming-conventions.html">Naming Conventions</a></li>
                <li><a href="boot-process.html">Boot Process</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="syscalls.html">System Calls</a></li>
                <li><a href="variables.html">Variables & Constants</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="page-header">
                <h1>BOOTMGR - FreeWorld Boot Manager</h1>
                <div class="meta">
                    <strong>Location:</strong> boot/BOOTMGR/bootmgr.asm<br>
                    <strong>Type:</strong> Boot Sector (Assembly)<br>
                    <strong>Architecture:</strong> x86_64 (16-bit boot code)
                </div>
            </div>

            <section class="section">
                <h2>Overview</h2>
                <p>BOOTMGR (Boot Manager) is the initial boot loader for FreeWorld OS. It is the first code executed when the system boots, responsible for initializing the system and loading the kernel into memory.</p>
                
                <div class="alert alert-info">
                    <strong>Note:</strong> BOOTMGR runs in 16-bit real mode and must fit within 512 bytes (boot sector size).
                </div>
            </section>

            <section class="section">
                <h2>Boot Sector Structure</h2>
                <p>The boot sector follows the standard PC boot sector format:</p>
                <ul>
                    <li><strong>Size:</strong> 512 bytes</li>
                    <li><strong>Boot Signature:</strong> 0xAA55 at bytes 510-511</li>
                    <li><strong>Entry Point:</strong> 0x7C00 (standard BIOS load address)</li>
                </ul>
            </section>

            <section class="section">
                <h2>Code Structure</h2>
                
                <h3>Assembly Directives</h3>
                <div class="code-block">
                    <pre>bits 16          ; 16-bit real mode
org 0x7C00      ; BIOS loads boot sector at 0x7C00</pre>
                </div>

                <h3>Entry Point: start</h3>
                <p>The <code class="code-inline">start</code> label is the entry point executed by the BIOS:</p>
                <div class="code-block">
                    <pre>start:
    cli              ; Disable interrupts
    xor ax, ax       ; Clear AX register
    mov ds, ax       ; Set data segment to 0
    mov es, ax       ; Set extra segment to 0
    mov ss, ax       ; Set stack segment to 0
    mov sp, 0x7C00   ; Set stack pointer</pre>
                </div>

                <h3>Functions</h3>
                
                <h4>print_string</h4>
                <p>Displays a null-terminated string using BIOS interrupt 0x10:</p>
                <div class="code-block">
                    <pre>print_string:
    lodsb            ; Load byte from [SI] into AL, increment SI
    or al, al        ; Check if AL is zero (end of string)
    jz done          ; Jump to done if zero
    mov ah, 0x0E     ; BIOS teletype function
    int 0x10         ; BIOS video interrupt
    jmp print_string ; Loop
done:
    ret              ; Return</pre>
                </div>

                <h4>load_kernel</h4>
                <p>Placeholder function for kernel loading logic (to be implemented):</p>
                <div class="code-block">
                    <pre>load_kernel:
    ; Kernel loading logic will be implemented
    ret</pre>
                </div>
            </section>

            <section class="section">
                <h2>JMP Instructions</h2>
                
                <h3>Jump to Kernel</h3>
                <p>After loading the kernel, BOOTMGR jumps to the kernel entry point:</p>
                <div class="code-block">
                    <pre>jmp 0x1000:0x0000  ; Far jump to kernel at segment 0x1000, offset 0x0000</pre>
                </div>
                
                <h3>Jump in print_string Loop</h3>
                <p>Conditional jump used in the string printing loop:</p>
                <div class="code-block">
                    <pre>jz done          ; Jump if zero flag is set (end of string)
jmp print_string ; Unconditional jump to continue loop</pre>
                </div>
            </section>

            <section class="section">
                <h2>Variables and Constants</h2>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>boot_msg</code></td>
                            <td>String</td>
                            <td>'FreeWorld Boot Manager v0.1'</td>
                            <td>Boot message displayed on startup</td>
                        </tr>
                        <tr>
                            <td><code>0x7C00</code></td>
                            <td>Address</td>
                            <td>0x7C00</td>
                            <td>BIOS boot sector load address</td>
                        </tr>
                        <tr>
                            <td><code>0xAA55</code></td>
                            <td>Signature</td>
                            <td>0xAA55</td>
                            <td>Boot sector signature (bytes 510-511)</td>
                        </tr>
                        <tr>
                            <td><code>0x1000:0x0000</code></td>
                            <td>Address</td>
                            <td>Segment:Offset</td>
                            <td>Kernel entry point address</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="section">
                <h2>Boot Process Flow</h2>
                <ol>
                    <li>BIOS loads boot sector (512 bytes) from disk to memory at 0x7C00</li>
                    <li>BIOS jumps to 0x7C00 (start label)</li>
                    <li>BOOTMGR initializes segments and stack</li>
                    <li>BOOTMGR displays boot message</li>
                    <li>BOOTMGR loads kernel into memory (via load_kernel)</li>
                    <li>BOOTMGR jumps to kernel entry point (0x1000:0x0000)</li>
                </ol>
            </section>

            <section class="section">
                <h2>Memory Layout</h2>
                <div class="code-block">
                    <pre>0x0000 - 0x03FF  : Interrupt Vector Table
0x0400 - 0x04FF  : BIOS Data Area
0x0500 - 0x7BFF  : Available
0x7C00 - 0x7DFF  : Boot Sector (512 bytes)
0x7E00 - 0x9FFF  : Available
0xA000 - 0xBFFF  : Video Memory
0xC000 - 0xFFFF  : BIOS ROM
0x1000:0x0000    : Kernel Entry Point</pre>
                </div>
            </section>

            <section class="section">
                <h2>BIOS Interrupts Used</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Interrupt</th>
                            <th>Function</th>
                            <th>AH Register</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0x10</td>
                            <td>Video Services</td>
                            <td>0x0E</td>
                            <td>Teletype output - prints character in AL register</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="section">
                <h2>Build Instructions</h2>
                <p>To build BOOTMGR:</p>
                <div class="code-block">
                    <pre>cd boot/BOOTMGR
nasm -f bin bootmgr.asm -o BOOTMGR.bin</pre>
                </div>
                <p>The output file <code class="code-inline">BOOTMGR.bin</code> is exactly 512 bytes and can be written to the first sector of a bootable disk.</p>
            </section>

            <section class="section">
                <h2>Integration Points</h2>
                <ul>
                    <li><strong>BCD:</strong> BOOTMGR may read BCD to determine boot configuration</li>
                    <li><strong>freeload.exe:</strong> BOOTMGR may load freeload.exe as the next stage loader</li>
                    <li><strong>Kernel:</strong> BOOTMGR loads and transfers control to fwoskrnl.exe</li>
                </ul>
            </section>
        </main>
    </div>

    <footer>
        <p>FreeWorld OS Documentation v0.1.0</p>
    </footer>

    <script src="../navigation.js"></script>
</body>
</html>

