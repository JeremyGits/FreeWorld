<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Manager - FreeWorld OS Documentation</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Input Manager</h1>
            <p class="subtitle">Centralized input handling for mouse and keyboard</p>
        </header>

        <nav class="sidebar">
            <h2>Navigation</h2>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li class="nav-section">GUI Subsystems</li>
                <li><a href="event-system.html">Event System</a></li>
                <li><a href="input-manager.html">Input Manager</a></li>
                <li><a href="clipboard.html">Clipboard & Drag & Drop</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="page-header">
                <h1>Input Manager</h1>
                <div class="meta">
                    <strong>Location:</strong> <code>system/input-manager.js</code><br>
                    <strong>Type:</strong> Core System Component<br>
                    <strong>Purpose:</strong> Centralized handling of all mouse and keyboard input
                </div>
            </div>

            <section class="section">
                <h2>Overview</h2>
                <p>The InputManager captures all mouse and keyboard input from the browser and emits standardized events to the EventBus. This provides a single point of input handling, similar to how OSes handle input at the kernel level.</p>
            </section>

            <section class="section">
                <h2>Features</h2>
                <ul>
                    <li><strong>Mouse State Tracking:</strong> Tracks position, button states, and target element</li>
                    <li><strong>Keyboard State Tracking:</strong> Tracks pressed keys and modifier keys (Ctrl, Alt, Shift, Meta)</li>
                    <li><strong>Event Normalization:</strong> Converts browser events to standardized format</li>
                    <li><strong>EventBus Integration:</strong> Emits all input to EventBus for component consumption</li>
                </ul>
            </section>

            <section class="section">
                <h2>Emitted Events</h2>
                
                <h3>Mouse Events</h3>
                <ul>
                    <li><code>input.mousedown</code> - Button pressed
                        <ul>
                            <li><code>data.x</code>, <code>data.y</code> - Mouse position</li>
                            <li><code>data.button</code> - 'left', 'right', or 'middle'</li>
                            <li><code>data.buttons</code> - Object with all button states</li>
                            <li><code>data.target</code> - Element under cursor</li>
                        </ul>
                    </li>
                    <li><code>input.mouseup</code> - Button released (same data structure)</li>
                    <li><code>input.mousemove</code> - Mouse moved (same data structure)</li>
                    <li><code>input.click</code> - Click detected</li>
                    <li><code>input.dblclick</code> - Double-click detected</li>
                    <li><code>input.contextmenu</code> - Right-click menu requested</li>
                </ul>

                <h3>Keyboard Events</h3>
                <ul>
                    <li><code>input.keydown</code> - Key pressed
                        <ul>
                            <li><code>data.key</code> - Key name (e.g., 'a', 'Enter', 'ArrowLeft')</li>
                            <li><code>data.code</code> - Physical key code</li>
                            <li><code>data.modifiers</code> - Object with Ctrl, Alt, Shift, Meta states</li>
                        </ul>
                    </li>
                    <li><code>input.keyup</code> - Key released (same data structure)</li>
                </ul>
            </section>

            <section class="section">
                <h2>Usage</h2>
                
                <h3>Initialization</h3>
                <pre><code>const eventBus = new EventBus();
const inputManager = new InputManager(eventBus);
window.freeworldInputManager = inputManager;</code></pre>

                <h3>Subscribing to Input Events</h3>
                <pre><code>// Listen for mouse clicks
eventBus.on('input.click', (event) => {
    console.log('Clicked at:', event.data.x, event.data.y);
    console.log('Target:', event.data.target);
});

// Listen for keyboard input
eventBus.on('input.keydown', (event) => {
    if (event.data.key === 'Enter' && event.data.modifiers.ctrl) {
        console.log('Ctrl+Enter pressed');
    }
});</code></pre>

                <h3>Getting Current State</h3>
                <pre><code>// Get current mouse state
const mouseState = inputManager.getMouseState();
console.log('Mouse at:', mouseState.x, mouseState.y);
console.log('Left button:', mouseState.buttons.left);

// Get current keyboard state
const keyboardState = inputManager.getKeyboardState();
console.log('Pressed keys:', Array.from(keyboardState.keys));
console.log('Ctrl pressed:', keyboardState.modifiers.ctrl);</code></pre>
            </section>

            <section class="section">
                <h2>Integration</h2>
                <p>The InputManager is the foundation of the input system. All other components that need input (DragDropSystem, window managers, etc.) subscribe to InputManager events via the EventBus rather than attaching their own DOM listeners.</p>
                
                <p>This ensures:</p>
                <ul>
                    <li>No duplicate event listeners</li>
                    <li>Consistent event format across all components</li>
                    <li>Easy debugging (all input flows through one place)</li>
                    <li>Components can be added/removed without affecting input handling</li>
                </ul>
            </section>
        </main>
    </div>
</body>
</html>

