<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture - FreeWorld OS Documentation</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Navigation</h2>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li class="nav-section">Boot Components</li>
                <li><a href="bootmgr.html">BOOTMGR</a></li>
                <li><a href="bcd.html">BCD</a></li>
                <li><a href="freeload.html">freeload.exe</a></li>
                <li class="nav-section">Core System</li>
                <li><a href="kernel.html">fwoskrnl.exe</a></li>
                <li><a href="hal.html">hal.dll</a></li>
                <li class="nav-section">Services</li>
                <li><a href="smss.html">smss.exe</a></li>
                <li><a href="csrss.html">csrss.exe</a></li>
                <li><a href="freeworldlogon.html">freeworldlogon.exe</a></li>
                <li class="nav-section">User Interface</li>
                <li><a href="shell.html">Shell</a></li>
                <li><a href="wanderer.html">Wanderer</a></li>
                <li class="nav-section">GUI Subsystems</li>
                <li><a href="dc.html">Device Context</a></li>
                <li><a href="compositor.html">Compositor</a></li>
                <li><a href="resources.html">Resource Manager</a></li>
                <li class="nav-section">System Services</li>
                <li><a href="api.html">System API</a></li>
                <li><a href="filesystem.html">Filesystem API</a></li>
                <li class="nav-section">Node.js System</li>
                <li><a href="window.html">Window API</a></li>
                <li><a href="desktop.html">Desktop</a></li>
                <li><a href="integration.html">System Integration</a></li>
                <li class="nav-section">Reference</li>
                <li><a href="naming-conventions.html">Naming Conventions</a></li>
                <li><a href="boot-process.html">Boot Process</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="syscalls.html">System Calls</a></li>
                <li><a href="variables.html">Variables & Constants</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="page-header">
                <h1>FreeWorld OS Architecture</h1>
                <div class="meta">
                    <strong>Purpose:</strong> System architecture overview
                </div>
            </div>

            <section class="section">
                <h2>Overview</h2>
                <p>FreeWorld OS uses a hybrid architecture combining low-level boot components (ASM/C/C++) with a high-level Node.js runtime for the core system.</p>
            </section>

            <section class="section">
                <h2>Architecture Layers</h2>
                
                <h3>Layer 1: Boot Layer (ASM/C/C++)</h3>
                <ul>
                    <li><strong>BOOTMGR:</strong> Boot manager (Assembly, 16-bit real mode)</li>
                    <li><strong>BCD:</strong> Boot Configuration Data (C)</li>
                    <li><strong>freeload.exe:</strong> OS loader (C)</li>
                    <li><strong>fwoskrnl.exe:</strong> Kernel executive
                        <ul>
                            <li><strong>kernel_entry.asm:</strong> Assembly boot code (16-bit → 32-bit → 64-bit transition)</li>
                            <li><strong>fwoskrnl.c:</strong> C kernel executive (32-bit protected mode, transitioning to 64-bit)</li>
                            <li><strong>arch/x64/:</strong> 64-bit architecture support (long mode transition, 64-bit kernel)</li>
                        </ul>
                    </li>
                    <li><strong>hal.dll:</strong> Hardware Abstraction Layer (C)</li>
                </ul>
                <div class="alert alert-success">
                    <strong>Status:</strong> Protected mode and long mode transitions are working. The kernel successfully transitions from 16-bit real mode to 32-bit protected mode, and then to 64-bit long mode. Full 64-bit support is implemented.
                </div>

                <h3>Layer 2: System Services (C)</h3>
                <ul>
                    <li><strong>smss.exe:</strong> Session Manager</li>
                    <li><strong>csrss.exe:</strong> Client Server Runtime</li>
                    <li><strong>freeworldlogon.exe:</strong> Login Manager</li>
                </ul>

                <h3>Layer 3: User Interface (C)</h3>
                <ul>
                    <li><strong>shell.exe:</strong> Command-line shell</li>
                    <li><strong>wanderer.exe:</strong> File manager</li>
                </ul>

                <h3>Layer 4: Node.js Runtime</h3>
                <ul>
                    <li><strong>system/index.js:</strong> Core system entry point</li>
                    <li><strong>system/window.js:</strong> Window management API</li>
                    <li><strong>system/desktop.js:</strong> Desktop environment</li>
                    <li><strong>system/api.js:</strong> System API</li>
                    <li><strong>system/filesystem.js:</strong> Filesystem API</li>
                </ul>
            </section>

            <section class="section">
                <h2>Supported Architectures</h2>
                <ul>
                    <li><strong>x86_64:</strong> Primary architecture
                        <ul>
                            <li>Boot: 16-bit real mode (x86 compatibility)</li>
                            <li>Kernel: 32-bit protected mode (current implementation)</li>
                            <li>Future: 64-bit long mode</li>
                        </ul>
                    </li>
                    <li><strong>ARM64:</strong> ARM 64-bit support (planned)</li>
                    <li><strong>RISC-V:</strong> RISC-V architecture support (planned)</li>
                    <li><strong>Future:</strong> Extensible for new architectures</li>
                </ul>
            </section>

            <section class="section">
                <h2>CPU Modes & Transitions</h2>
                <h3>Boot Sequence</h3>
                <ol>
                    <li><strong>Real Mode (16-bit):</strong>
                        <ul>
                            <li>BIOS loads boot sector at 0x7C00</li>
                            <li>BOOTMGR executes in 16-bit real mode</li>
                            <li>Kernel entry point starts in 16-bit real mode</li>
                        </ul>
                    </li>
                    <li><strong>Protected Mode (32-bit):</strong>
                        <ul>
                            <li>GDT setup (flat memory model, 4GB segments)</li>
                            <li>A20 line enable</li>
                            <li>CR0.PE bit set</li>
                            <li>32-bit far jump to protected mode entry point</li>
                            <li>Segment registers reloaded with protected mode selectors</li>
                            <li>IDT initialized</li>
                        </ul>
                    </li>
                    <li><strong>Long Mode (64-bit):</strong> Planned for future</li>
                </ol>
            </section>

            <section class="section">
                <h2>Filesystem Structure</h2>
                <p>FreeWorld uses a Linux-like filesystem structure:</p>
                <ul>
                    <li><code>/bin</code> - Essential binaries</li>
                    <li><code>/boot</code> - Boot files</li>
                    <li><code>/dev</code> - Device files</li>
                    <li><code>/etc</code> - Configuration files</li>
                    <li><code>/home</code> - User home directories</li>
                    <li><code>/lib</code> - Shared libraries</li>
                    <li><code>/mnt</code> - Mount points</li>
                    <li><code>/opt</code> - Optional software</li>
                    <li><code>/proc</code> - Process information</li>
                    <li><code>/root</code> - Root user home</li>
                    <li><code>/sbin</code> - System binaries</li>
                    <li><code>/sys</code> - System information</li>
                    <li><code>/tmp</code> - Temporary files</li>
                    <li><code>/usr</code> - User programs</li>
                    <li><code>/var</code> - Variable data</li>
                </ul>
            </section>

            <section class="section">
                <h2>Window Management</h2>
                <p>FreeWorld provides an HWND-like API for window management:</p>
                <ul>
                    <li><strong>Window Handles:</strong> Format "FW_HWND_&lt;id&gt;"</li>
                    <li><strong>Window Classes:</strong> Window, WindowManager</li>
                    <li><strong>Message Loop:</strong> Handled by CSRSS</li>
                    <li><strong>Desktop Environment:</strong> Similar to KDE, GNOME, Windows</li>
                </ul>
            </section>

            <section class="section">
                <h2>Cross-Platform Support</h2>
                <p>FreeWorld supports both Windows and Linux file operations:</p>
                <ul>
                    <li>Path separators handled automatically</li>
                    <li>File permissions supported</li>
                    <li>Long file names supported</li>
                    <li>Case sensitivity handled</li>
                </ul>
            </section>
        </main>
    </div>

    <footer>
        <p>FreeWorld OS Documentation v0.1.0</p>
    </footer>

    <script src="../navigation.js"></script>
</body>
</html>

